<!DOCTYPE html>
<body>
    <form>
        <!-- <label for="username">Username:</label><br> -->
        <input type="text" id="username" name="name"><br>
        <input type="submit" value="Submit">
    </form>
    <div id=divID></div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // Load Search Query and Variables
        hyKey = "d990aded-5abf-4931-82fc-23b1fbe1114c"
        const params = new URLSearchParams(window.location.search)
        console.log(params.get("name"))
        div = document.getElementById("divID")
        // Test if there is any search query.
        if (params.get("name") == null) {
        } else {
            // Contact API for UUID
        axios.get(`https://api.ashcon.app/mojang/v2/user/${params.get("name")}`)
            .then(function (response) {
                window.uuid = response.data.uuid
                window.username = response.data.username
                console.log(response.data.uuid)
                console.log(response.data.username)
                // Get Friends using Hypixel API.
                axios.get(`https://api.hypixel.net/friends?key=${hyKey}&uuid=${window.uuid}`)
                    .then(function (friendResponse) {
                friends = []
                console.log(friendResponse.data.records)
                // Check which UUID is the friend.
                for (let i = 0; i < friendResponse.data.records.length; i++) {
                    uuidSender = friendResponse.data.records[i].uuidSender
                    uuidReceiver = friendResponse.data.records[i].uuidReceiver
                    if (uuidSender == window.uuid) {
                        if (friends.includes(uuidReceiver) == false) {
                            friends.push(uuidReceiver)
                        }
                    } else {
                        if (friends.includes(uuidSender) == false) {
                            friends.push(uuidSender)
                }}}
                console.log(friends)
                // Change those UUIDs back into usernames.
                for (let i = 0; i < friends.length; i++) {
                    window.friendsUser = []
                    axios.get(`https://api.ashcon.app/mojang/v2/user/${friends[i]}`)
                        .then(function (mojangResponse) {
                            console.log(mojangResponse.data.username)
                            div.innerHTML += `<a href="?name=${mojangResponse.data.username}">${mojangResponse.data.username}</a><br>`
        })}})})}
    </script>
</body>